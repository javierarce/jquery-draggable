<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title></title>
    <script src="http://www.google.com/jsapi"></script>
    <script>google.load("jquery", "1.7.1");</script>
    <script>

      $(function() {

        $.fn.drags = function(opt) {

          opt = $.extend({ cursor: "move" }, opt);

          var $canvas = opt.canvas;

          var onCanvasMouseUp = function() {
            $(".draggable").removeClass('draggable');
          }

          $("body").on("mouseup", onCanvasMouseUp);

          var onMouseDown = function(e) {

            e.preventDefault(); 

            var $drag = $(this).addClass('draggable');

            var
            z_idx = $drag.css('z-index'),
            drg_h = $drag.outerHeight(),
            drg_w = $drag.outerWidth(),
            pos_y = $drag.offset().top  + drg_h - e.pageY,
            pos_x = $drag.offset().left + drg_w - e.pageX;

            var onMouseUp = function() {
              $(this).css('z-index', z_idx);
            };

            var onMouseMove = function(e) {

              var top  = e.pageY + pos_y - drg_h;
              var left = e.pageX + pos_x - drg_w;

              var r = $canvas.offset().left + $canvas.width();
              var b = $canvas.offset().top + $canvas.height();

              if (left - 20 < $canvas.offset().left ) {
                left = $canvas.offset().left;
              }  else if (left + drg_w + 20 >  r ) {
                left = r - drg_w;
              } 

              if (top - 20 < $canvas.offset().top ) {
                top = $canvas.offset().top;
              } else if (top + drg_h + 20 >  b ) {
                top = b - drg_h;
              } 


              $('.draggable').offset({ top: top, left: left }).on("mouseup", onMouseUp);
              

            }

            $drag.css('z-index', 1000).parents().on("mousemove", onMouseMove);

          };

          var onMouseUp = function() {
            $(this).removeClass('draggable');
          };

          return this.css('cursor', opt.cursor).on("mousedown", onMouseDown).on("mouseup", onMouseUp);

        }

        $(".canvas > div").drags( { canvas: $(".canvas") } );

      });

    </script>

    <style>

      body, html {
        position:relative;
        width: 100%; height: 100%;
      }

      body {
        background: #333;
        padding: 0; 
        margin: 0;
      }

      div {
        position: absolute;
        left: 20px;
        top: 20px;
        width: 100px; height: 100px;

        background: red;
        color: white;
        border-radius: 3px;
      }

      div.draggable { background: #ccc; }

      .two { background: blue; width: 50px; height: 100px; left: 100px;  top: 100px; }

      .canvas {
        position: absolute; 
        width: 800px;
        height: 400px;
        margin-left: -400px;
        margin-top: -200px;
        top: 50%;
        left: 50%;
        background:#fff;
        border-radius: 3px;
        box-shadow: 0px 0px 7px #000;
      }

    </style>
  </head>
  <body>
    <div class="canvas">
      <div></div> <div class="two"></div>
    </div>
  </body>
</html>
